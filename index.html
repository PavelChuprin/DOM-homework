<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments">
			<!-- Список рендерится из JS -->
      </ul>
      <div class="add-form">
        <input
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш комментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
			<button class="remove-form-button">Удалить последний комментарий</button>
          <button class="add-form-button">Написать</button>
        </div>
      </div>
    </div>
  </body>

  <script>
const nameElement = document.querySelector(".add-form-name");
const commentElement = document.querySelector(".add-form-text");
const addButtonElement = document.querySelector(".add-form-button");
const listElement = document.querySelector(".comments");
const formElement = document.querySelector(".add-form");
const removeButtonElement = document.querySelector(".remove-form-button");
const date = new Date();

// Создаем массив для хранения комментариев
const commentators = [
	{
		name: "Глеб Фокин",
		date: "12.02.22 12:18",
		comment: "Это будет первый комментарий на этой странице",
		likeCounter: 3,
		likeCondition: false, // состояние кнопки - лайк
		isEdit: false, // состояние edit/save
	},
	{
		name: "Варвара Н.",
		date: "13.02.22 19:22",
		comment: "Мне нравится как оформлена эта страница! ❤",
		likeCounter: 75,
		likeCondition: true,
		isEdit: false,
	},
];

// Создаем рендер-функцию
const renderCommentators = () => {
	const commentatorsHtml = commentators.map((commentator, index) => {
		return commentator.isEdit ? 
		`<li class="comment">
			<div class="comment-header">
				<div>${commentator.name}</div>
				<div>${commentator.date}</div>
			</div>
			<div class="comment-body">
				<textarea id="input" class="comment-text" type="texrarea">${commentator.comment}</textarea>
			</div>
			<div class="comment-footer">
				<button data-index="${index}" class="save-form-button">Сохранить</button>
				<div class="likes">
					<span class="likes-counter">${commentator.likeCounter}</span>
					<button class="like-button ${commentator.likeCondition ? '-active-like' : ''}" data-index="${index}"></button>
				</div>
			</div>
			</li>`
		:
		`<li class="comment">
			<div class="comment-header">
				<div>${commentator.name}</div>
				<div>${commentator.date}</div>
			</div>
			<div class="comment-body">
				<div class="comment-text">${commentator.comment}</div>
			</div>
			<div class="comment-footer">
				<button data-index="${index}" class="edit-form-button">Редактировать</button>
				<div class="likes">
					<span class="likes-counter">${commentator.likeCounter}</span>
					<button class="like-button ${commentator.likeCondition ? '-active-like' : ''}" data-index="${index}"></button>
				</div>
			</div>
			</li>`
	})
	.join('');
	listElement.innerHTML = commentatorsHtml;
	funcLikes();
	editMessage();
	saveMessage();
}
renderCommentators();

// Кнопка лайков
function funcLikes() {
	const buttonLikes = document.querySelectorAll(".like-button");
	for (const btnLike of buttonLikes) {
		const index = btnLike.dataset.index;
		btnLike.addEventListener("click", () => {
			if (commentators[index].likeCondition === true) {
				commentators[index].likeCondition = false;
				commentators[index].likeCounter -= 1;
			} else {
				commentators[index].likeCondition = true;
				commentators[index].likeCounter += 1;
			}
		renderCommentators();
		})
	}
}

// Редактирование текста написанного комментария
function editMessage() {
	const buttonEdit = document.querySelectorAll(".edit-form-button");
	for (const edBtn of buttonEdit) {
		const index = edBtn.dataset.index;
		edBtn.addEventListener("click", () =>{
			commentators[index].isEdit ? commentators[index].isEdit = false : commentators[index].isEdit = true;
			renderCommentators();
		})
	}
}

// Кнопка сохранения комментария
function saveMessage() {
	const buttonSave = document.querySelectorAll(".save-form-button");
	const inputMessage = document.getElementById("input");
	for (const saveBtn of buttonSave) {
		const index = saveBtn.dataset.index;
		saveBtn.addEventListener("click", () => {
			commentators[index].isEdit = false;
			commentators[index].comment = inputMessage.value;
			renderCommentators();
		})
	}
}

//Добавляем обработчик события на клик по кнопке "Добавить"
	addButtonElement.addEventListener("click", () => {
		nameElement.classList.remove("error"); //здесь стили (error) удаляются, если всё хорошо
		if (nameElement.value === "") { // если поле ввода пустое
			nameElement.classList.add("error"); // то добавляем новые стили (error) для поля ввода
			return;
		}
		commentElement.classList.remove("error");
		if (commentElement.value === "") {
			commentElement.classList.add("error");
			return;
		}
		funcButton();
	});

// Функция для добавления нового блока комментариев
function funcButton() {
	commentators.push({
		name: nameElement.value,
		date: `${date.getDate() < 10 ? "0" : ""}${date.getDate()}.${date.getMonth() < 10 ? "0" : ""}${date.getMonth() + 1}.${date.getFullYear() - 2000} ${date.getHours() < 10 ? "0" : ""}${date.getHours()}:${date.getMinutes() < 10 ? "0" : ""}${date.getMinutes()}`,
		comment: commentElement.value,
		likeCounter: 0,
		likeCondition: false,
		isEdit: false,
	})
	renderCommentators();
	nameElement.value = ""; // очищаем поле формы после ввода
	commentElement.value = "";
}

// Расширенная валидация.Кнопка некликабельна, если имя или текст в форме незаполненные
formElement.addEventListener("input", () => {
	if (nameElement.value === "" || commentElement.value === "") { // проверяем пуста ли строка?
		addButtonElement.disabled = true; // если да, то делаем кнопку disabled(неполноценной)
	} else {
		addButtonElement.disabled = false; // иначе, кнопка кликабельна
	}
});

// Добавление элемента в список по нажатию Enter
formElement.addEventListener("keyup", (e) => {
	if (e.code === "Enter" && nameElement.value !== "" && commentElement.value !== "") {
		funcButton();
	}
});

// Удаление последнего элемента
removeButtonElement.addEventListener("click", () => {
	const lastComment = listElement.innerHTML.lastIndexOf('<li class="comment">');
	listElement.innerHTML = listElement.innerHTML.slice(0, lastComment);
});
</script>
</html>
